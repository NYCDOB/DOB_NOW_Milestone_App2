<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>DOB NOW Job Filings</title>   
  <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">  
  <link rel="icon" type="image/png"  href="data/dob_logo.png">	
  <link href="css/styles.css" rel="stylesheet"> 
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css' rel='stylesheet' type='text/css'/>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.12/r-2.1.0/se-1.2.0/datatables.min.css">
  <link href="build/nv.d3.css" rel="stylesheet" type="text/css">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<style>





input  {
	font-size: 14px;
}

.qzz {
	color: white;
	background-color: #46A6DD;
	border-color: white;
	font-weight:bold; 
	font-size:18px;
	padding: 10px ;
}

.qzz:hover {
	background: #002878;
	color: white;
}

.textOR::before {
	content: "OR";
	font-size: 1.3em;
	color: rgb(201, 198, 198);
}



	body{
		height: 100vh;
		margin: 0;
		padding: 0;
		overflow: auto;
	}



	.hr-sect {
		display: flex;
		flex-basis: 100%;
		align-items: center;
		color: rgba(0, 0, 0, 0.35);


	}
	.hr-sect::before,
	.hr-sect::after {
		content: "";
		flex-grow: 1;
		background: rgba(0, 0, 0, 0.35);
		height: 1px;
		font-size: 0px;
		line-height: 0px;
		margin: 0px 8px;
	}
	.ui-autocomplete{
            max-height: 150px;
            overflow-y: auto;
            /* prevent horizontal scrollbar */
            overflow-x: hidden;
            /* add padding to account for vertical scrollbar */
            padding-right: 20px;	
	}



	@media screen and (min-width: 0px) {
		body {
			padding-top: 100px;
		}
	}	
	@media screen and (min-width: 1200px) {
		body {
			padding-top: 50px;
		}

	}





</style>

<body >

	<nav class="navbar navbar-default  navbar-fixed-top" style="min-height:50px" >
		<div class="container-fluid">
				<div class="navbar-header">

					<a class=" navbar-brand navbar-link" href="https://www1.nyc.gov/site/buildings/index.page" target="_blank">
						<img alt="" src="" height="50px" >
					</a>
					<a class="navbar-link" style="text-decoration: none;" href="index_splash.html">
							<!--  <div class="navbar-text" title="Job Filings Home" style="color:#44a8de; font-size:35px;font-weight:bold;margin:auto 1px;">  -->
								<span style="color:#44a8de; font-size:35px;font-weight:bold;">
									DOB NOW Job Filings
								</span>
							<!-- </div>  -->
					</a>					
					<button type="button"  class="navbar-toggle collapsed  " data-toggle="collapse" 
					data-target="#collapse-content" title="Menu" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse"  id="collapse-content">
					<div>
					<a class="navbar-link navbar-right" href="https://a810-dobnow.nyc.gov/Publish/#!/" target="_blank">
						<span class="toggleText navbar-text hidden-lg hidden-md hidden-sm mynavlink h4" style="">DOB Build Now</span>
						<img alt="DOB NOW Build logo" class="visible-lg-inline visible-md-inline visible-sm-inline" src="http://a810-dobnow.nyc.gov/Publish/images/dob_now_build.jpg" height="50px" >
					</a>
					</div>

  					<div>
						<a class="navbar-link navbar-right" href="https://github.com/NYCDOB/DOB_NOW_Milestone_App/blob/gh-pages/README.md" target="_blank">
							<span class="toggleText navbar-text mynavlink h4" style="padding-right:50px;">About</span>
						</a>
					</div>
				</div>
		</div>
	</nav>




<div class="container-fluid">
	<div class="row" >
		<div class=""  style="font-size:24px;margin-left:15px;margin-top:5px;    color: #002878">
			<em>Search DOB NOW Job Filings by...</em>
		</div>
	</div>
</div>

<div class="container" >  <!-- MULTIPLE FILINGS -->
	<div class="row">
			<div class="col-lg-6 col-lg-offset-3" style="border: 3px solid black;padding-bottom: 30px;margin-top:10px;margin-bottom:20px;">
				<div class="row"  >
					<div  style="font-size:24px;background-color: navy;color:white;padding-left: 10px;margin-bottom:30px;">MULTIPLE FILINGS</div>
				</div>
				<div class="row">
					<div class="text-center" style="font-size:22px;"><b>Search by Work Type, Geography, and Time Frame</b></div>
				</div>
				<div class="row">
					<div class="text-center" style="font-size:22px;margin-bottom:20px;"><em>View map, table, and summary statics</em></div>
				</div>
				<div class="row">
					<div class="text-center">
						<button class="zbtn zbtn-default qzz text-center"  id="btnAggFilings"  onclick="location.href='index_multiFiling.html'">GO</button>
					</div>	
				</div>
			</div>
	</div>

	<div class="row">  <!-- MULTIPLE FILINGS -->
		<div class="col-lg-6 col-lg-offset-3" style="border: 3px solid black;padding-bottom: 30px;margin-top:10px;margin-bottom:20px;">
			<div class="row"  >
				<div  style="font-size:24px;background-color: navy;color:white;padding-left: 10px;margin-bottom:30px;">INDIVIDUAL FILINGS</div>
			</div>
			<div class="row">
				<div class="col-sm-7">
					<div class="row" >
						<div style="font-weight:bold; font-size:20px;margin-left: 20px;">Job Number:</div>
					</div>
					<div class="row" >
						<input type="text" class="" style="margin-left: 20px;"  id="jobNumTxtBox" value="B00000043-I1" size="40">
					</div>
				</div>
				<div class="col-sm-1" style=" padding-top:10px; padding-bottom: 10px;">
					<button class="zbtn zbtn-default qzz text-center"  id="btnIndFilings">SEARCH</button>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-7" style="font-size: 18px; color: red;line-height:1px;visibility:hidden;margin-left: 20px;" id="notFoundJobNum">
					No matching job number!
				</div>
			</div>


			<div class="row" style="margin: 30px auto;" id="separator">
				<div class="col-xs-2 col-sm-5 zvisible-lg-inline "  style="border-bottom: solid 1px rgba(0, 0, 0, 0.35);;height: 10px;"></div>
				<div class="col-xs-2 col-sm-2 textOR text-center" style="color: grey;"></div>
				<div class="col-xs-2 col-sm-5  "  style="border-bottom: solid 1px rgba(0, 0, 0, 0.35);height: 10px;"></div>
			</div>

			<div class="row">
				<div class="col-sm-7">
					<div class="row" >
						<div style="font-weight:bold; font-size:20px;margin-left: 20px;">Applicant Name:</div>
					</div>
					
					<div class="row" >
						<input type="text" id="appNameTxtBox" name="appNameText"  class=""  style="margin-left: 20px;"  placeholder="First or Last" size="40">
					</div>
				</div>
				<div class="col-sm-1" style=" padding-top:10px; padding-bottom: 10px;">
					<button class="zbtn zbtn-default qzz text-center"  id="btnIndFilingsName">SEARCH</button>
				</div>

			</div>
			
			<div class="row">
				<div class="col-sm-7" style="font-size: 18px; color: red;line-height:1px;visibility:hidden;margin-left: 20px;" id="notFoundName">
					No matching name!
				</div>
			</div>
						

			<div class="row" style="margin: 30px auto;" id="separator">
				<div class="col-xs-2 col-sm-5 "  style="border-bottom: solid 1px rgba(0, 0, 0, 0.35);;height: 10px;"></div>
				<div class="col-xs-2 col-sm-2 textOR text-center" style="color: grey;"></div>
				<div class="col-xs-2 col-sm-5  "  style="border-bottom: solid 1px rgba(0, 0, 0, 0.35);height: 10px;"></div>
			</div>


			<div class="row">
					<div class="col-sm-7">
						<div class="row" >
							<div style="font-weight:bold; font-size:20px;margin-left: 20px;">Address:</div>
						</div>
						<div class="row" >
							<input type="text" id="appAddressTxtBox" name="appAddressText" class="" style="margin-left: 20px;"  size="40">
						</div>
					</div>

					<div class="col-sm-1" style=" padding-top:10px; padding-bottom: 10px;">
						<button class="zbtn zbtn-default qzz text-center"  id="btnIndFilingsAddress">SEARCH</button>
					</div>

			</div>
			<div class="row">
				<div class="col-sm-7" style="font-size: 18px; color: red;line-height:1px;visibility:hidden;margin-left: 20px;" id="notFoundAddress">
					No matching address!
				</div>
			</div>
			
		</div>
	</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"></script>
<script src="Leaflet.D3SvgOverlay-master/L.D3SvgOverlay.min.js"></script>
<script src='https://code.jquery.com/jquery-3.3.1.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="js/topics.js"></script>
<script src="js/jscript.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/v/dt/dt-1.10.12/r-2.1.0/se-1.2.0/datatables.min.js"></script>
<script src="build/nv.d3.js"></script>
  
<script>

$(document).ready(function(){
	
	var filingsSearch = document.getElementById('btnIndFilings'),
		appNameSearch = document.getElementById('btnIndFilingsName'),
		appAddressSearch = document.getElementById('btnIndFilingsAddress'),
		key_ID,
		appName,
		appAddress;
		let setName = new Set();
		let setAddress = new Set();
		let setJob = new Set();



	d3.csv("https://raw.githubusercontent.com/NYCDOB/MA/gh-pages/milestone.csv", function(data){
	//d3.csv("milestone.csv", function(data){
		data.forEach(function(d){
			d.name = d["Applicant Name"];
			d.keyID = d["Job Number"];   //[d.key_id];
			setName.add(d["Applicant Name"]);
			setAddress.add(  d.Address );
			setJob.add(  d.keyID );
		})
		
		
		appJob = Array.from(setJob); 
		//appName = data.map(function(d){return d.name});
		appName = Array.from(setName);  //data.map(function(d){return d.name});
		//appAddress = data.map(function(d){return d.Address});
		appAddress = Array.from(setAddress) ; 



		$("#jobNumTxtBox").autocomplete({  //might be duplicate job numbers, so maybe filter on job number + worktype
			//source: _.uniq(appName),
			source: appJob,
			minLength:6
		});
		filingsSearch.onclick = function(){		
			var	jobNumTxt = document.getElementById("jobNumTxtBox").value,
			workTypeSelect = $('#dropdownWT').val() || null ;
			
			var filteredData = data.filter(function(d){
				if(d.keyID == jobNumTxt){
					return d.keyID
				}
			});
			
			//key_ID = filteredData.map(function(d){return d.keyID});
			
			if (filteredData.length > 0) {
				//var url = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_property#" + key_ID;
				//var url = "index_property.html#" + key_ID;
				var url = "index_property.html#" + filteredData[0].keyID;
				location.href = url;
			} else {
			 document.querySelector("#notFoundJobNum").style.visibility="visible";
			}
		}

		$("#appNameTxtBox").autocomplete({
			//source: _.uniq(appName),
			source: appName,
			minLength:2
		});
		appNameSearch.onclick = function(){
			var appNameTxt = $('input[name=appNameText]').val().toUpperCase();
			var filteredData = data.filter(function(d){
				if(d.name.toUpperCase() == appNameTxt){
					return d.keyID
				}
			});
			key_ID = filteredData.map(function(d){return d.keyID});
			
			if (key_ID.length == 1){
				//var url = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_property#" + key_ID;
				var url = "index_property.html#" + key_ID;
				location.href = url;
			} else  if ( key_ID.length > 1) {
				//var multiFilingURL = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_indivFilingMultiReturn#" + appNameTxt;
				var multiFilingURL = "index_indivFilingMultiReturn.html#" + appNameTxt;
				location.href = multiFilingURL;
			} else {
			 document.querySelector("#notFoundName").style.visibility="visible";
			}
		}
		
		
		
		
		$("#appAddressTxtBox").autocomplete({
			//source: _.uniq(appAddress),
			source: appAddress ,  //_.uniq(appAddress),
			minLength:2
		});
		appAddressSearch.onclick = function(){
			var appAddressTxt = $('input[name=appAddressText]').val().toUpperCase();
			var filteredAddress = data.filter(function(d){
				if(d.Address.toUpperCase() == appAddressTxt){
					return d.keyID
				}
			});
			//key_ID = data.map(function(d){return d.keyID});
			key_ID = filteredAddress.map(function(d){return d.keyID});
			if (key_ID.length == 1){
				//var url = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_property#" + key_ID;
				var url = "index_property.html#" + key_ID;
				location.href = url;
			} else if (key_ID.length > 1 ) {
				// var multiFilingAddressURL = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_indivFilingMultiReturnAddress#" + appAddressTxt;   
				var multiFilingAddressURL = "index_indivFilingMultiReturnAddress.html#" + appAddressTxt;
				location.href = multiFilingAddressURL;
			} else {
			 document.querySelector("#notFoundAddress").style.visibility="visible"; 
			}
		}
		
	});
});

</script>

</body>
</html>
