<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>DOB NOW Job Filings</title>   
  <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">  
  <link href="css/styles.css" rel="stylesheet"> 
  <link rel="icon" type="image/png"  href="data/dob_logo.png">  
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css' rel='stylesheet' type='text/css'/>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.12/r-2.1.0/se-1.2.0/datatables.min.css">
  <link href="build/nv.d3.css" rel="stylesheet" type="text/css">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<style>

	body{
		padding-top:50px
	}
	#multiFiling-text {	
		margin-top: 20px ;
		margin-bottom: 20px ;
		font-size: 20px;
		color: #002878;
		text-align: center;
	}
	#tableDiv{
		border: 3px solid black;
		min-height: 400px;
		padding: 10px;
	}
	#filingsTable{
		font-size: 12px;
		display: block;
	}

	#mapBtn{
		padding: 5px 5px 5px 5px;
		background: #46A6DD;
		color: white;
		font-size: 18px;
		font-weight: bold;
	}
	#mapBtn:hover{
		background: #002878;
	}
	#mapBtn:disabled{
		color: #a9a9a9;
		background: #D8D8D8;
	}

	#loadpage{		
		background-color:white; 
		margin-top: 25%;	
	}

	@media screen and (min-width: 0px) {
		body {
			padding-top: 100px;
			
		}
	}	
	@media screen and (min-width: 1200px) {
		body {
			padding-top: 70px;
		}

	}


</style>

<body>
	<nav class="navbar navbar-default  navbar-fixed-top" style="min-height:50px" >
		<div class="container-fluid">
				<div class="navbar-header">

					<a class=" navbar-brand navbar-link" href="https://www1.nyc.gov/site/buildings/index.page" target="_blank">
						<img alt="" src="" height="50px" >
					</a>
					<a class="navbar-link" style="text-decoration: none;" href="index_splash.html">
							<!--  <div class="navbar-text" title="Job Filings Home" style="color:#44a8de; font-size:35px;font-weight:bold;margin:auto 1px;">  -->
								<span style="color:#44a8de; font-size:35px;font-weight:bold;">
									DOB NOW Job Filings
								</span>
							<!-- </div>  -->
					</a>					
					<button type="button"  class="navbar-toggle collapsed " data-toggle="collapse" 
					data-target="#collapse-content" title="Menu" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse"  id="collapse-content">
					<div class="znavbar-right znavbar-link">
						<div>
							<a class="znavbar-link navbar-right" href="https://a810-dobnow.nyc.gov/Publish/#!/" target="_blank">
								<span class="toggleText navbar-text hidden-lg hidden-md hidden-sm mynavlink h4" style="">DOB Build Now</span>
								<img alt="DOB NOW Build logo" class="visible-lg-inline visible-md-inline visible-sm-inline" src="http://a810-dobnow.nyc.gov/Publish/images/dob_now_build.jpg" height="50px" >
							</a>
						</div>
						<div>
							<a class="znavbar-link navbar-right" href="https://github.com/NYCDOB/DOB_NOW_Milestone_App/blob/gh-pages/README.md" target="_blank">
								<span class="toggleText navbar-text mynavlink h4" style="padding-right:50px;">About</span>
							</a>						
						</div>

						<div>
							<a class="znavbar-link navbar-right" href="index_splash.html" >
								<span class="toggleText navbar-text mynavlink h4" style="padding-right:50px;">Home</span>
							</a>						
						</div>
				</div>
				
				</div>
		</div>
	</nav>


<div class="container">
	<div class="row">
		<div class="col-lg-6 col-lg-offset-3" id="multiFiling-text">	
				<div>	<i><b>MULTIPLE JOB FILINGS FOUND...</b></i>			</div>
				<div>	Click on a job number to view the <i><b>Milestone Page</b>	</i>		</div>
				<div>	or click on the <i><b>Map Data</b></i> button to view all filings on a map.			</div>
			</div>
	</div>

	
    <div class="row">  		
		<div class="col-lg-6 col-lg-offset-3">	
			<div id="tableDiv">				
				<div class="text-center" id="loadpage"> 
						Loading...Please wait!<br>
						<img id="loader" src="data/spinner.gif">
				</div>
				
				<table id="filingsTable" class="display szzzzz" style="zwidth:100%;">
					<thead >
						<tr class="tableRows" style="visibility:hidden">
							<th></th>
							<th>Job Number</th>
							<th>Applicant Name</th>
							<th class="none">BIN:</th>
							<th class="none">Work Type:</th>
							<th class="none">Filing Date:</th>
							<th class="none">House Number:</th>
							<th class="none">Street:</th>
							<th class="none">Borough:</th>
							<th class="none">Community District:</th>							
						</tr>						
					</thead>
				</table>
			</div>
		</div>		
	</div>

	<div class="row">
		<div class="col-lg-6 col-lg-offset-3 text-center" style="margin-top:15px;">
				<button type="button" form="ui-radio" id="mapBtn">Map Data</button>
		</div>
	</div>

</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"></script>
<script src="Leaflet.D3SvgOverlay-master/L.D3SvgOverlay.min.js"></script>
<script src='https://code.jquery.com/jquery-3.3.1.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="js/topics.js"></script>
<script src="js/jscript.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/v/dt/dt-1.10.12/r-2.1.0/se-1.2.0/datatables.min.js"></script>
<script src="build/nv.d3.js"></script>

<script>

$(document).ready(function(){
	var multiFilingName = window.location.hash.substring(1)
	//var multiFilingName = "CHRIS SIDERIS";
	var multiFilingNameSpc = decodeURI(multiFilingName);
	var filteredData;
	var format = d3.time.format("%-m/%-d/%Y").parse;
	var multiFilingMap = document.getElementById('mapBtn');
	function loadTable(){
		$(function(){
				var table = $('#filingsTable').DataTable({
						data: filteredData,
						  'responsive': {
							'details': {
							   'type': 'column',
							   'target': 0
							}
						  },
						columnDefs: [{
						   'data': null,
						   'defaultContent': '',
						   'className': 'control',
						   'orderable': false,
							'targets': 0

						}],
						  'columns': [ 
							 { 'data': null }, 
							 { 'data': "key_id",
							   'render': function(data,type,row,meta){ 
									//return '<a href= "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_property#' + data +'" target="_blank">' + data + '</a>';
									return '<a href= "index_property.html#' + data +'" target="_blank">' + data + '</a>';
							 }},
							 { 'data': "Applicant Name" },
							 { 'data': "Bin" },
							 { 'data': "Work Type Name" },
							 { 'data': "Filing Date" },
							 { 'data': "House Number" },
							 { 'data': "Street Name" },
							 { 'data': "Borough.0" },
							 { 'data': "Community Board" }					 
						  ],
						  'select': {
							 'style': 'single',

						  },
							'lengthChange': false,
							'scrollY': '270px',
							'scrollCollapse': true,
							'paging': false,
							'order': [[1, "asc"]]
					});
					$('#loadpage').hide();
					document.querySelector(".tableRows").style.visibility = "visible";

		});
	}

	
	d3.csv("https://raw.githubusercontent.com/NYCDOB/MA/gh-pages/milestone.csv", function(data){
		data.forEach(function(d){
					d.bin = [d.Bin];				
					d.HouseNum = d["House Number"];
					d.Street = d["Street Name"];
					d.CD = d["Community Board"];
					d.Borough = [d.Borough.toUpperCase()];
					d.jobNum = d["Job Number"];
					d.workType = d["Work Type Name"];
					d.key_id = [d.key_id];
					d.filingDate = format(d["Filing Date"]);
					d.name = d["Applicant Name"];
		})
		filteredData = data.filter(function(d){
			return d.name == multiFilingNameSpc;
		})

		loadTable();
		
		multiFilingMap.onclick = function(){
				// var multiFilingURL = "https://nycdob.github.io/DOB_NOW_Milestone_App2/index_indivFilingMultiMap#" + multiFilingName;  
				var multiFilingURL = "index_indivFilingMultiMap.html#" + multiFilingName;
				location.href = multiFilingURL;
			}
	});
	
});

</script>

</body>
</html>
